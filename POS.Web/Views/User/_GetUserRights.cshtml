@using POS.Utilities.ViewModel
@using POS.Utilities.Services
@model IEnumerable<UserRightViewModel>
@{
    Layout = null;
    int SearchUserId = (int)Session["SearchUserId"];
}

<link href="https://www.jqueryscript.net/css/jquerysctipttop.css" rel="stylesheet" type="text/css">
<link href="~/Content/hummingbird-treeview/hummingbird-treeview.min.css" rel="stylesheet" />
<style>
    body {
        background-color: #fafafa;
    }

    .container {
        margin: 150px auto;
        min-height: 100vh;
    }

    .stylish-input-group .input-group-addon {
        background: white !important;
    }

    .stylish-input-group .form-control {
        box-shadow: 0 0 0;
        border-color: #ccc;
    }

    .stylish-input-group button {
        border: 0;
        background: transparent;
    }

    .h-scroll {
        background-color: #fcfdfd;
        height: 260px;
        overflow-y: scroll;
    }
</style>


<div class="">
    <div class="overflow-auto p-3 mb-3 mb-md-0 mr-md-3 bg-light" style="max-height: 700px;">

        <!-- Small boxes (Stat box) -->
        <div class="row">
            <div id="treeview_container" class="hummingbird-treeview well h-scroll-large">
                <!-- <div id="treeview_container" class="hummingbird-treeview"> -->

                <ul id="treeview" class="hummingbird-base">
                    @{
                        @Html.HiddenFor(m => SearchUserId)
                        foreach (var m in UserServices.GetAllParentMenus())
                        {
                            if (m.ParentId == null)
                            {
                                if (Model.Where(p => p.MenuId == m.Id).FirstOrDefault() != null)
                                {
                                    <li>
                                        <i class="fa fa-plus"></i> <label> <input id="root" data-mid="@m.Id" type="checkbox" value="@m.Id" checked> @m.Name</label>
                                        @if (UserServices.GetAllMainMenusByParentId(m.Id)?.Count > 0)
                                        {
                                            foreach (var sub in UserServices.GetAllChildMenus(m.Id))
                                            {
                                                <ul>
                                                    @if (Model.Where(p => p.MenuId == sub.Id).FirstOrDefault() != null)
                                                    {
                                                        <li>
                                                            <label> <input class="hummingbirdNoParent" id="child" data-sid="@sub.Id" type="checkbox" value="@sub.Id" checked>  @sub.Name</label>
                                                        </li>
                                                    }
                                                    else
                                                    {
                                                        <li>
                                                            <label> <input class="hummingbirdNoParent" id="child" data-sid="@sub.Id" type="checkbox" value="@sub.Id">  @sub.Name</label>
                                                        </li>
                                                    }
                                                </ul>
                                            }
                                        }
                                    </li>
                                }
                                else
                                {
                                    <li>
                                        <i class="fa fa-plus"></i> <label> <input id="root" data-mid="@m.Id" type="checkbox" value="@m.Id"> @m.Name</label>
                                        @if (UserServices.GetAllMainMenusByParentId(m.Id)?.Count > 0)
                                        {
                                            foreach (var sub in UserServices.GetAllMainMenusByParentId(m.Id))
                                            {
                                                var submenu = UserServices.GetMainMenuById(sub.Id);
                                                <ul>
                                                    <li>
                                                        <label> <input class="hummingbirdNoParent" id="child" data-sid="@submenu.Id" type="checkbox" value="@submenu.Id">@submenu.Name</label>
                                                    </li>
                                                </ul>
                                            }
                                        }
                                    </li>
                                }
                            }
                        }
                    }
                </ul>
            </div>
        </div>
        <!-- /.row -->

        <div class="row">
            <div class="btn-group">
                <button type="button" class="btn btn-primary" id="checkAll">Check All</button>
                <button type="button" class="btn btn-default" id="uncheckAll">Uncheck All</button>
                <button type="button" class="btn btn-success" id="btnSave">Save Changing</button>
            </div>
        </div>


    </div>
</div>

<script src="~/Content/hummingbird-treeview/hummingbird-treeview.min.js"></script>
<script>
    $("#treeview").hummingbird();
    $("#checkAll").click(function () {
        $("#treeview").hummingbird("checkAll");
    });
    $("#uncheckAll").click(function () {
        $("#treeview").hummingbird("uncheckAll");
    });
    $("#btnSave").click(function () {
        //debugger;
        //var itemData = [];
        //$(':checkbox:checked').each(function () {
        //    var mid = $(this).data('mid');
        //    //get last checked childern
        //    if ($(this).parent().not(':has(ul)').length > 0) {
        //        var sid = $(this).data('sid');
        //        //var value = $(this).val();

        //        // alert(name + ':' + value);
        //    }

        //    var itemRow = {
        //        ParentMenu: mid,
        //        ChildMenu: sid
        //    }
        //    itemData.push(itemRow);
        //});

        //console.log(itemData);

        var userID = $("#SearchUserId").val();

        var val = [];
        $(':checkbox:checked').each(function (i) {
            val[i] = $(this).val();
        });
        console.log(val);

        if (userID == "" || val == "")
        {
            alertify.error("Please Select the Areas !!!");
            return;
        }
        else
        {
             var modelData = {

                 UserId: userID,
                 UserRights: val

             };
            startLoader();

            $.ajax({
                url: '@Url.Action("AddUserRights", "User")',
                contentType: 'application/json; charset=utf-8',
                type: "POST",
                data: JSON.stringify(modelData),
                datatype: "Json",
            }).done(function (res) {
                console.log(res);
                if (res == "Error" || res == "") {
                    alertify.error("Something went wrong");
                }
                else if (res == "Success") {
                    alertify.success("Saved successfully");
                    location.reload();
                }

                stopLoader();
           });
        }

    });
</script>